<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Invoice Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f7fa;
    }
    .container {
      display: flex;
      height: 100vh;
    }
    .form-section, .preview-section {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }
    .form-section {
      background: #fff;
      border-right: 2px solid #ddd;
    }
    .form-section h2, .preview-section h2 {
      text-align: center;
      margin-bottom: 15px;
      color: #333;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
      color: #444;
    }
    select, input {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      margin-top: 15px;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      background: #007bff;
      color: #fff;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      background: #0056b3;
    }
    .invoice {
      background: #fff;
      border: 1px solid #ccc;
      padding: 20px;
      border-radius: 8px;
      display: none;
    }
    .invoice-content {
      position: relative;
      z-index: 1;
    }
    #downloadBtn {
      display: none;
      margin-top: 10px;
      background: #28a745;
    }
    #downloadBtn:hover {
      background: #1e7e34;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- LEFT: FORM -->
    <div class="form-section">
      <h2>Invoice Form</h2>

      <!-- Institution -->
<label for="institutionSelect">Institution</label>
<select id="institutionSelect">
  <option value="">-- Select Institution --</option>
</select>

<!-- Venue from Google Sheet -->
<label for="venueSelect">Venue Booked (From Institution)</label>
<select id="venueSelect">
  <option value="">-- Select Venue --</option>
</select>

<!-- NEW: Venue for Cost -->
<label for="venueCostSelect">Venue Booked (For Cost)</label>
<select id="venueCostSelect">
  <option value="">-- Select Venue --</option>
  <option value="Effah Hall (Full Auditorium) - With Additional Services">Effah Hall (Full Auditorium) - With Additional Services</option>
  <option value="Effah Hall (Full Auditorium) - No Additional Services">Effah Hall (Full Auditorium) - No Additional Services</option>
  <option value="Effah Hall (Ground Floor) - With Additional Services">Effah Hall (Ground Floor) - With Additional Services</option>
  <option value="Effah Hall (Ground Floor) - No Additional Services">Effah Hall (Ground Floor) - No Additional Services</option>
  <option value="Ahmed Jinapor Hall">Ahmed Jinapor Hall</option>
  <option value="Kwame Dattey Hall">Kwame Dattey Hall</option>
  <option value="Nikoi Kotey Hall">Nikoi Kotey Hall</option>
</select>

<!-- Venue Cost -->
<label for="venueCostInput">Venue Cost</label>
<input type="number" id="venueCostInput" placeholder="Auto-filled Venue Cost" readonly>

      

      <label for="serviceInput">Additional Services</label>
<select id="serviceInput">
  <option value="">-- None --</option>
  <option value="Additional Services">Additional Services</option>
</select>

      
      <label for="recipientName">Invoice Recipient Name</label>
<input list="recipientNameList" id="recipientName" placeholder="Recipient Name">
<datalist id="recipientNameList"></datalist>

      <label for="recipientEmail">Invoice Recipient Email</label>
<input list="recipientEmailList" id="recipientEmail" placeholder="Recipient Email">
<datalist id="recipientEmailList"></datalist>

      <label for="invoiceId">Invoice No.</label>
      <input type="text" id="invoiceId" readonly>

      <label for="dated">Date</label>
      <input type="date" id="dated">

      
      <label for="totalInput">Total</label>
      <input type="number" id="totalInput" placeholder="Total" readonly>

      <button onclick="generateInvoice()">Generate Invoice</button>
    </div>

    <!-- RIGHT: PREVIEW -->
    <div class="preview-section">
      <div id="invoice" class="invoice">
        <div class="invoice-content">

          <!-- Watermark Logo -->
          <div id="watermark">
            <img src="logo1.jpg" alt="Logo">
          </div>

          <style>
            #invoice {
              position: relative;
            }
            #watermark {
              position: absolute;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              opacity: 0.08;
              width: 120px;
              text-align: center;
              pointer-events: none;
              z-index: 0;
            }
            #watermark img {
              width: 100%;
            }
            .invoice-content {
              position: relative;
              z-index: 1;
            }
          </style>

          <!-- Header -->
          <div class="invoice-header" style="text-align:center; margin:6px 0 12px 0;">
            <img src="logo1.jpg" alt="Logo" style="height:70px; display:block; margin:0 auto;" crossorigin="anonymous">
          </div>

          <!-- Invoice -->
          <table style="width:100%; border-collapse: collapse;">
            <tr>
              <td style="width:70%; vertical-align: top;">
                <p><b>GTEC HOSPITALITY MANAGEMENT SERVICES</b></p>
                <p>P.O.BOX MB 28</p>
                <p>MINISTRIES â€“ ACCRA</p>
                <p>Contact: 0244202959, 0244660848</p>
                <p>Email: hospitality@gtec.edu.gh</p>
              </td>
              <td style="width:30%; border:1px solid #000; padding:5px;">
                <p><strong>Invoice No.:</strong> <span id="invoiceNo"></span></p>
                <p><b>Date:</b> <span id="invDate"></span></p>
              </td>
            </tr>
          </table>

          <!-- Recipient details -->
          <div style="margin: 20px 0;">
            <p><strong>Coordinator:</strong> <span id="billToName"></span></p>
            <p><strong>Email:</strong> <span id="billToEmail"></span></p>
          </div>
<br><br>
          
          <!-- Invoice Title -->
          <h2 style="text-align:center; margin:10px 0;">INVOICE</h2>

          <!-- Invoice items table -->
          <table style="width:100%; border-collapse: collapse;" border="1" id="itemsTable">
            <tr>
              <th style="width:10%;">SI No.</th>
              <th style="width:70%;">DESCRIPTION</th>
              <th style="width:20%;">AMOUNT</th>
            </tr>
          </table>
          <br><br><br><br>

          <!-- Footer -->
          <table style="width:100%; margin-top:20px; border-collapse: collapse;">
            <tr>
              <td style="width:55%; border:1px solid #000; padding:8px; vertical-align:top;">
                <p><i><b>KINDLY NOTE:</b></i></p>
                <ol style="margin:0; padding-left:15px;">
                  <b><i>
                  <li>A refundable Deposit of 10% of the total cost is required to be paid by cash</li>
                  <li>50% payment is required to secure the venue</li>
                  <li>Full payment should be made before the actual date of the programme</li>
                  </i></b>
                </ol>
              </td>
              <td style="width:45%; border:1px solid #000; padding:0;">
                <table style="width:100%; border-collapse: collapse;" border="1">
                  <tr><td><b>A/c Holderâ€™s Name</b></td><td><b>GTEC CONFERENCE</b></td></tr>
                  <tr><td><b>Bank Name</b></td><td><b>AGRICULTURAL DEVELOPMENT BANK</b></td></tr>
                  <tr><td><b>A/c No.</b></td><td><b>0701010009158801</b></td></tr>
                  <tr><td><b>Branch & Bank Code</b></td><td><b>Gulf House</b></td></tr>
                  <tr><td><b>SWIFT CODE</b></td><td>________________</td></tr>
                </table>
              </td>
            </tr>
          </table>
          <br>
          <br>

          <!-- Signature -->
         <div style="text-align:right; margin-top:40px;">
  <p>Signature: ________________________</p>
  <p style="margin-top:3px; font-size:12px; font-weight:bold;">
    AG. HEAD, HOSPITALITY MANAGEMENT SERVICES
  </p>
</div>


        </div>
      </div>
    </div>
    <button id="downloadBtn">Download PDF</button>
  </div>
  <button id="downloadBtn">Download PDF</button>


  

  <script>
    const sheetCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR9htPtAQjzUItZtpzGxl71AVEqki52Kj6hqbxcenA1wEwQt0wuH5yB6gkv0Mx_UQki_MLnS5ZBRuey/pub?gid=201909864&single=true&output=csv";
    let entries = [];

    document.addEventListener("DOMContentLoaded", async () => {
      try {
        const res = await fetch(sheetCSV);
        if (!res.ok) throw new Error("Failed to fetch CSV");
        const csvText = await res.text();

        const rows = csvText.trim().split("\n").map(r => r.split(","));
        const headers = rows[0].map(h => h.trim().toLowerCase());

        entries = rows.slice(1).map(r => {
          const obj = {};
          headers.forEach((h, i) => {
            obj[h] = r[i] ? r[i].trim() : "";
          });
          return obj;
        });

        populateInstitutions();
      } catch (err) {
        console.error("Error:", err);
        alert("Unable to load data from sheet.");
      }
    });
    
    populateInstitutions();
populateRecipients();  // ðŸ‘ˆ this is new



    function populateRecipients() {
  // Get all unique names & emails from your sheet entries
  const nameSet = new Set(entries.map(e => e["recipient name"]).filter(Boolean));
  const emailSet = new Set(entries.map(e => e["recipient email"]).filter(Boolean));

  // Get the datalist elements from your HTML
  const nameList = document.getElementById("recipientNameList");
  const emailList = document.getElementById("recipientEmailList");

  // Clear them first (in case they already have options)
  nameList.innerHTML = "";
  emailList.innerHTML = "";

  // Add each unique name as <option> in recipientNameList
  nameSet.forEach(name => {
    const opt = document.createElement("option");
    opt.value = name;
    nameList.appendChild(opt);
  });

  // Add each unique email as <option> in recipientEmailList
  emailSet.forEach(email => {
    const opt = document.createElement("option");
    opt.value = email;
    emailList.appendChild(opt);
  });
}



// Auto-link recipient name and email
document.getElementById("recipientName").addEventListener("input", function () {
  const name = this.value;
  const match = entries.find(e => e["recipient name"] === name);
  if (match) {
    document.getElementById("recipientEmail").value = match["recipient email"] || "";
  }
});

document.getElementById("recipientEmail").addEventListener("input", function () {
  const email = this.value;
  const match = entries.find(e => e["recipient email"] === email);
  if (match) {
    document.getElementById("recipientName").value = match["recipient name"] || "";
  }
});

    
    

// Map venue names to their costs
const venueCosts = {
  "Effah Hall (Full Auditorium) - With Additional Services": 14000,
  "Effah Hall (Full Auditorium) - No Additional Services": 12000,
  "Effah Hall (Ground Floor) - With Additional Services": 12000,
  "Effah Hall (Ground Floor) - No Additional Services": 10000,
  "Ahmed Jinapor Hall": 5000,
  "Kwame Dattey Hall": 3500,
  "Nikoi Kotey Hall": 2500
};

// Autofill venue cost when selecting from the "For Cost" dropdown
document.getElementById("venueCostSelect").addEventListener("change", function () {
  const selectedVenue = this.value;
  const costInput = document.getElementById("venueCostInput");

  if (venueCosts[selectedVenue]) {
    costInput.value = venueCosts[selectedVenue].toFixed(2);
  } else {
    costInput.value = "";
  }
});



    

    function populateInstitutions() {
      const instSet = new Set(entries.map(e => e["name of institution"]).filter(Boolean));
      const instSelect = document.getElementById("institutionSelect");
      instSelect.innerHTML = '<option value="">-- Select Institution --</option>';
      instSet.forEach(inst => {
        const opt = document.createElement("option");
        opt.value = inst;
        opt.textContent = inst;
        instSelect.appendChild(opt);
      });
      instSelect.onchange = onInstitutionChange;
    }

    
    function onInstitutionChange() {
  const inst = document.getElementById("institutionSelect").value;
  const venueSelect = document.getElementById("venueSelect");
  venueSelect.innerHTML = '<option value="">-- Select Venue --</option>';

  if (!inst) {
    venueSelect.disabled = true;
    return;
  }

  const filtered = entries.filter(e => e["name of institution"] === inst);

  // âœ… Autofill recipient when institution is chosen
  if (filtered.length > 0) {
    document.getElementById("recipientName").value = filtered[0]["recipient name"] || "";
    document.getElementById("recipientEmail").value = filtered[0]["recipient email"] || "";
  }

  // âœ… Populate venue list
  filtered.forEach(e => {
    const vOpt = document.createElement("option");
    vOpt.value = e["venue booked"];
    vOpt.textContent = e["venue booked"];
    venueSelect.appendChild(vOpt);
  });

  venueSelect.disabled = false;
}

    

    function generateInvoiceNo() {
      const prefix = "GTEC-HMS";
      const year = new Date().getFullYear().toString().slice(-2);
      let lastNumber = localStorage.getItem("lastInvoiceNumber") || 0;
      lastNumber = parseInt(lastNumber) + 1;
      const invoiceNumber = String(lastNumber).padStart(3, "0");
      localStorage.setItem("lastInvoiceNumber", lastNumber);
      return `${prefix}-${year}-${invoiceNumber}`;
    }

    
    function generateInvoice() {
  const venue = document.getElementById("venueSelect").value;
  const service = document.getElementById("serviceInput").value.trim();
  const recipientName = document.getElementById("recipientName").value.trim();
  const recipientEmail = document.getElementById("recipientEmail").value.trim();
  const dateVal = document.getElementById("dated").value || new Date().toLocaleDateString();

  const venueCost = parseFloat(document.getElementById("venueCostInput").value) || 0;

  // Generate Invoice No.
  const invoiceNo = generateInvoiceNo();
  document.getElementById("invoiceId").value = invoiceNo; // left form
  document.getElementById("invoiceNo").textContent = invoiceNo; // inside preview
  document.getElementById("invDate").textContent = dateVal;

  // Recipient
  document.getElementById("billToName").textContent = recipientName;
  document.getElementById("billToEmail").textContent = recipientEmail;

  // Build items
  let items = [];
  if (venue) items.push({ desc: venue, amount: venueCost });
  if (service === "Additional Services") {
    items.push({ desc: service, amount: "" }); // empty instead of 0.00
  }

  // Calculate total only from numeric amounts
  let totalCost = items.reduce((sum, item) => sum + (typeof item.amount === "number" ? item.amount : 0), 0);

  // Build rows
  let rowsHTML = "";
  if (venue) {
    rowsHTML += `
      <tr>
        <td>1</td>
        <td>
          ${venue}
          ${service === "Additional Services" ? "<br><span style='font-style:italic;'>Additional Services</span>" : ""}
        </td>
        <td>${venueCost.toFixed(2)}</td>
      </tr>
    `;
  }

  rowsHTML += `
    <tr>
      <td colspan="2" style="text-align:right;"><b>TOTAL</b></td>
      <td>${totalCost.toFixed(2)}</td>
    </tr>
  `;

  document.getElementById("itemsTable").innerHTML = `
    <tr>
      <th style="width:10%;">SI No.</th>
      <th style="width:70%;">DESCRIPTION</th>
      <th style="width:20%;">AMOUNT</th>
    </tr>
    ${rowsHTML}
  `;

  // Show total in left form too 
  document.getElementById("totalInput").value = totalCost.toFixed(2);

  document.getElementById("invoice").style.display = "block";
  document.getElementById("downloadBtn").style.display = "inline-block";
}


    document.getElementById("downloadBtn").addEventListener("click", () => {
  const institution = document.getElementById("institutionSelect").value || "Institution";
  const today = new Date();
  const dateStr = today.getFullYear() + "-" +
                  String(today.getMonth() + 1).padStart(2, "0") + "-" +
                  String(today.getDate()).padStart(2, "0");

  const fileName = `GTEC_Conference_Facility-${institution}-${dateStr}.pdf`.replace(/\s+/g, "_");

  const invoiceElem = document.getElementById("invoice");
  html2pdf().from(invoiceElem).save(fileName);
});

  </script>
</body>
</html>












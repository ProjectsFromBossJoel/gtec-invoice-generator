<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Invoice Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    select, input { margin: 5px; padding: 5px; }
    table { border-collapse: collapse; width: 100%; margin-top: 15px; }
    table, th, td { border: 1px solid black; padding: 8px; text-align: left; }
    #invoice { border: 2px solid black; padding: 20px; margin-top: 20px; display: none; }
    .download-btn { display: none; margin-top: 10px; padding: 8px 12px; }
  </style>
</head>
<body>
  <h2>Invoice Generator</h2>

  <label>Institution:</label>
  <select id="institutionSelect"></select><br>

  <label>Event:</label>
  <select id="eventSelect"></select><br>

  <label>Venue:</label>
  <select id="descSelect"></select><br>

  <label>Additional Services:</label>
  <select id="serviceSelect" multiple></select><br>

  <label>Invoice No:</label>
  <input type="text" id="invoiceId"><br>

  <label>Date:</label>
  <input type="date" id="dated"><br>

  <label>SI No:</label>
  <input type="text" id="siNo"><br>

  <label>Venue Cost:</label>
  <input type="number" id="amountInput"><br>

  <label>Additional Services Cost:</label>
  <input type="number" id="additionalInput"><br>

  <label>Total:</label>
  <input type="number" id="totalInput"><br>

  <button onclick="generateInvoice()">Generate Invoice</button>
  <button id="downloadBtn" class="download-btn" onclick="downloadInvoice()">Download Invoice</button>

  <div id="invoice">
    <h3 style="text-align:center;">INVOICE</h3>
    <p><b>Invoice No:</b> <span id="invNo"></span></p>
    <p><b>Date:</b> <span id="invDate"></span></p>

    <table>
      <tr>
        <th>SI</th>
        <th>Description</th>
        <th>Amount</th>
      </tr>
      <tr>
        <td id="siCell"></td>
        <td id="eventDesc"></td>
        <td id="amount"></td>
      </tr>
      <tr id="servicesRow" style="display:none;">
        <td></td>
        <td id="servicesDesc"></td>
        <td id="servicesCost"></td>
      </tr>
      <tr>
        <td colspan="2"><b>Total</b></td>
        <td id="total"></td>
      </tr>
    </table>

    <p><b>COORDINATOR :</b> <span id="coordName">____________________</span></p>
  </div>

  <script>
    // Demo data - replace with your CSV fetch later
    const data = {
      "Institution A": {
        "Event 1": {
          "Venue X": ["Catering", "Decoration", "Security"],
          "Venue Y": ["Lighting", "Sound"]
        }
      },
      "Institution B": {
        "Event 2": {
          "Venue Z": ["Transport", "Photography"]
        }
      }
    };

    // Populate Institution dropdown
    const institutionSelect = document.getElementById("institutionSelect");
    Object.keys(data).forEach(inst => {
      const option = document.createElement("option");
      option.value = inst;
      option.textContent = inst;
      institutionSelect.appendChild(option);
    });

    // Event dropdown
    institutionSelect.addEventListener("change", () => {
      const eventSelect = document.getElementById("eventSelect");
      eventSelect.innerHTML = "";
      const inst = institutionSelect.value;
      Object.keys(data[inst]).forEach(ev => {
        const option = document.createElement("option");
        option.value = ev;
        option.textContent = ev;
        eventSelect.appendChild(option);
      });
      eventSelect.dispatchEvent(new Event("change"));
    });

    // Venue dropdown
    document.getElementById("eventSelect").addEventListener("change", () => {
      const descSelect = document.getElementById("descSelect");
      descSelect.innerHTML = "";
      const inst = institutionSelect.value;
      const ev = document.getElementById("eventSelect").value;
      Object.keys(data[inst][ev]).forEach(venue => {
        const option = document.createElement("option");
        option.value = venue;
        option.textContent = venue;
        descSelect.appendChild(option);
      });
      descSelect.dispatchEvent(new Event("change"));
    });

    // Additional Services dropdown
    document.getElementById("descSelect").addEventListener("change", () => {
      const serviceSelect = document.getElementById("serviceSelect");
      serviceSelect.innerHTML = "";
      const inst = institutionSelect.value;
      const ev = document.getElementById("eventSelect").value;
      const venue = document.getElementById("descSelect").value;
      data[inst][ev][venue].forEach(service => {
        const option = document.createElement("option");
        option.value = service;
        option.textContent = service;
        serviceSelect.appendChild(option);
      });
    });

    // Generate Invoice
    function generateInvoice() {
      const selectedServices = Array.from(
        document.getElementById("serviceSelect").selectedOptions
      ).map(opt => opt.value).join(", ");

      document.getElementById("invNo").textContent = document.getElementById("invoiceId").value;
      document.getElementById("invDate").textContent = document.getElementById("dated").value || new Date().toLocaleDateString();
      document.getElementById("siCell").textContent = document.getElementById("siNo").value;

      // Coordinator (institution name)
      const instName = document.getElementById("institutionSelect").value;
      document.getElementById("coordName").textContent = instName || "____________________";

      // Venue
      const venue = document.getElementById("descSelect").value;
      document.getElementById("eventDesc").textContent = venue;

      // Venue cost
      document.getElementById("amount").textContent = document.getElementById("amountInput").value;

      // Additional services row
      if (selectedServices) {
        document.getElementById("servicesRow").style.display = "table-row";
        document.getElementById("servicesDesc").textContent = "Services: " + selectedServices;
        document.getElementById("servicesCost").textContent = document.getElementById("additionalInput").value;
      } else {
        document.getElementById("servicesRow").style.display = "none";
      }

      // Total
      document.getElementById("total").textContent = document.getElementById("totalInput").value;

      document.getElementById("invoice").style.display = "block";
      document.getElementById("downloadBtn").style.display = "inline-block";
    }

    // Download Invoice
    function downloadInvoice() {
      const element = document.getElementById("invoice");
      html2pdf().from(element).save("invoice.pdf");
    }

    // Initialize with first institution
    institutionSelect.dispatchEvent(new Event("change"));
  </script>
</body>
</html>
